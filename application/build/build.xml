<?xml version="1.0" encoding="UTF-8"?>

<project name="MyProject" default="build">

    <property name="buildDir" value="/tmp/build/"/>

    <fileset id="srcfiles" dir="..">
        <include name="src/*"/>
        <include name="config/*"/>
        <include name="public/*"/>
        <exclude name="*.tmp"/>
    </fileset>

    <target name="build">
        <echo msg="Building project..."/>
        <mkdir dir="${buildDir}"/>
        <copy todir="${buildDir}">
            <fileset refid="srcfiles"/>
        </copy>
    </target>

    <target name="clean">
        <echo msg="Cleaning build directory..."/>
        <delete dir="${buildDir}" includeemptydirs="true" verbose="true" failonerror="true" quiet="true" />
    </target>

    <target name="deploy" depends="test,build">
        <echo msg="Deploying project..."/>
    </target>

    <target name="test" description="Runs tests" depends="phpunit">
        <!--<echo msg="A fake test message!" />-->
    </target>

    <target name="phpunit" description="Runs phpunit tests">

        <echo msg="Running phpunit..."/>

        <exec command="scripts/wait_for_services.sh" dir=".." passthru="true"/>

        <phpunit
                haltonerror="true"
                haltonfailure="true"
                printsummary="true"
                haltonskipped="true"
                haltonincomplete="true"
                bootstrap="../bootstrap.php"
        >
            <formatter type="plain" usefile="false"/>
            <batchtest>
                <fileset dir="../tests/">
                    <include name="*/*Test.php"/>
                </fileset>
            </batchtest>
        </phpunit>
    </target>


</project>